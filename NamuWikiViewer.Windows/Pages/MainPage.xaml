<?xml version="1.0" encoding="utf-8" ?>
<Page
    x:Class="NamuWikiViewer.Windows.Pages.MainPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:dev="using:DevWinUI"
    xmlns:local="using:NamuWikiViewer.Windows.Pages"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:md="using:NamuWikiViewer.Commons.Models"
    xmlns:root="using:NamuWikiViewer.Windows"
    mc:Ignorable="d">

    <Page.Resources>
        <Storyboard x:Name="OpenMenuStoryboard" Completed="OnOpenMenuStoryboardCompleted">
            <DoubleAnimation
                Storyboard.TargetName="MenuGridTransform"
                Storyboard.TargetProperty="X"
                To="0"
                Duration="0:0:0.25">
                <DoubleAnimation.EasingFunction>
                    <CubicEase EasingMode="EaseOut" />
                </DoubleAnimation.EasingFunction>
            </DoubleAnimation>
        </Storyboard>

        <Storyboard x:Name="CloseMenuStoryboard" Completed="OnCloseMenuStoryboardCompleted">
            <DoubleAnimation
                Storyboard.TargetName="MenuGridTransform"
                Storyboard.TargetProperty="X"
                To="335"
                Duration="0:0:0.25">
                <DoubleAnimation.EasingFunction>
                    <CubicEase EasingMode="EaseOut" />
                </DoubleAnimation.EasingFunction>
            </DoubleAnimation>
        </Storyboard>
    </Page.Resources>

    <Grid>
        <Frame x:Name="MainFrame" Navigated="OnMainFrameNavigated" />

        <ScrollViewer
            x:Name="PendingPageScrollViewer"
            HorizontalAlignment="Stretch"
            VerticalAlignment="Bottom"
            HorizontalScrollBarVisibility="Auto"
            HorizontalScrollMode="Auto"
            PointerWheelChanged="OnPendingPageScrollViewerPointerWheelChanged"
            VerticalScrollMode="Disabled">
            <ItemsRepeater Margin="8" ItemsSource="{x:Bind root:App.GlobalPreferenceViewModel.PendingPages}">
                <ItemsRepeater.Layout>
                    <StackLayout Orientation="Horizontal" Spacing="8" />
                </ItemsRepeater.Layout>

                <ItemsRepeater.ItemTemplate>
                    <DataTemplate x:DataType="md:PendingPage">
                        <StackPanel
                            Padding="8"
                            HorizontalAlignment="Left"
                            Background="{ThemeResource SolidBackgroundFillColorBaseBrush}"
                            BorderBrush="#808080"
                            BorderThickness="1"
                            CornerRadius="8"
                            Orientation="Horizontal"
                            Spacing="8"
                            Tag="{x:Bind Id}"
                            Tapped="OnPendingPageItemTapped"
                            Translation="0,0,32">
                            <StackPanel.Shadow>
                                <ThemeShadow />
                            </StackPanel.Shadow>
                            <TextBlock HorizontalAlignment="Center" Text="{x:Bind PageName}" />
                            <Button
                                Padding="0"
                                HorizontalAlignment="Center"
                                Background="Transparent"
                                BorderThickness="0"
                                Click="OnDeletePendingPageButtonClicked"
                                Tag="{x:Bind Id}">
                                <SymbolIcon Foreground="{StaticResource SystemAccentColor}" Symbol="Cancel" />
                            </Button>
                        </StackPanel>
                    </DataTemplate>
                </ItemsRepeater.ItemTemplate>
            </ItemsRepeater>
        </ScrollViewer>

        <Grid
            x:Name="MenuBackdrop"
            Background="Transparent"
            Tapped="OnMenuBackdropTapped"
            Visibility="Collapsed" />

        <Grid
            x:Name="MenuGrid"
            Width="335"
            HorizontalAlignment="Right"
            VerticalAlignment="Stretch"
            CornerRadius="8,0,0,8">
            <Grid.RenderTransform>
                <TranslateTransform x:Name="MenuGridTransform" X="335" />
            </Grid.RenderTransform>

            <Rectangle Fill="{ThemeResource ThemeColor}" Opacity="0.3" />

            <dev:BlurEffectControl
                BlurAmount="10"
                IsBlurEnabled="True"
                IsTintEnabled="False" />

            <Grid Padding="12" RowSpacing="8">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="*" />
                    <RowDefinition Height="Auto" />
                </Grid.RowDefinitions>

                <Grid Grid.Row="0" HorizontalAlignment="Stretch">
                    <TextBlock
                        HorizontalAlignment="Left"
                        VerticalAlignment="Center"
                        FontWeight="ExtraBold"
                        Style="{StaticResource BodyLargeStrongTextBlockStyle}"
                        Text="방문 기록" />

                    <Button
                        Padding="8"
                        HorizontalAlignment="Right"
                        VerticalAlignment="Center"
                        Background="Transparent"
                        BorderThickness="0"
                        Click="OnSettingsButtonClicked">
                        <SymbolIcon Symbol="Setting" />
                    </Button>
                </Grid>

                <Rectangle
                    Grid.Row="1"
                    Height="1"
                    VerticalAlignment="Top"
                    Fill="#808080" />

                <ListView
                    Grid.Row="1"
                    Padding="0,8,0,4"
                    ItemsSource="{x:Bind root:App.GlobalPreferenceViewModel.ReversedPageHistories, Mode=OneWay}"
                    SelectionMode="None">
                    <ListView.ItemContainerStyle>
                        <Style TargetType="ListViewItem">
                            <Setter Property="HorizontalContentAlignment" Value="Stretch" />
                            <Setter Property="BorderThickness" Value="0" />
                            <Setter Property="Margin" Value="0,0,0,4" />
                            <Setter Property="Padding" Value="0" />
                        </Style>
                    </ListView.ItemContainerStyle>

                    <ListView.ItemTemplate>
                        <DataTemplate x:DataType="md:PageHistory">
                            <Button
                                Padding="0"
                                HorizontalAlignment="Stretch"
                                HorizontalContentAlignment="Stretch"
                                Background="Transparent"
                                BorderThickness="0"
                                Click="OnHistoryButtonClicked"
                                Tag="{x:Bind Id}">
                                <Grid
                                    Padding="8"
                                    HorizontalAlignment="Stretch"
                                    Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                                    ColumnSpacing="8"
                                    CornerRadius="4">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*" />
                                        <ColumnDefinition Width="Auto" />
                                    </Grid.ColumnDefinitions>

                                    <TextBlock
                                        Grid.Column="0"
                                        VerticalAlignment="Center"
                                        MaxLines="1"
                                        Text="{x:Bind PageName}"
                                        TextTrimming="CharacterEllipsis" />

                                    <Button
                                        Grid.Column="1"
                                        Padding="8"
                                        Background="Transparent"
                                        BorderThickness="0"
                                        Click="OnDeleteHistoryButtonClicked"
                                        Tag="{x:Bind Id}">
                                        <FontIcon FontSize="16" Glyph="&#xE74D;" />
                                    </Button>
                                </Grid>
                            </Button>
                        </DataTemplate>
                    </ListView.ItemTemplate>
                </ListView>

                <Rectangle
                    Grid.Row="1"
                    Height="1"
                    VerticalAlignment="Bottom"
                    Fill="#808080" />

                <dev:ElementGroup Grid.Row="2" HorizontalAlignment="Stretch">
                    <Button HorizontalAlignment="Stretch">
                        <StackPanel Orientation="Horizontal" Spacing="8">
                            <FontIcon
                                VerticalAlignment="Center"
                                FontSize="14"
                                Glyph="&#xE932;" />
                            <TextBlock VerticalAlignment="Center" Text="편집" />
                        </StackPanel>
                    </Button>
                    <Button HorizontalAlignment="Stretch">
                        <StackPanel Orientation="Horizontal" Spacing="8">
                            <FontIcon
                                VerticalAlignment="Center"
                                FontSize="14"
                                Glyph="&#xE90A;" />
                            <TextBlock VerticalAlignment="Center" Text="토론" />
                        </StackPanel>
                    </Button>
                    <Button HorizontalAlignment="Stretch">
                        <StackPanel Orientation="Horizontal" Spacing="8">
                            <FontIcon
                                VerticalAlignment="Center"
                                FontSize="14"
                                Glyph="&#xE81C;" />
                            <TextBlock VerticalAlignment="Center" Text="역사" />
                        </StackPanel>
                    </Button>
                    <Button HorizontalAlignment="Stretch">
                        <StackPanel Orientation="Horizontal" Spacing="8">
                            <FontIcon
                                VerticalAlignment="Center"
                                FontSize="14"
                                Glyph="&#xE7A6;" />
                            <TextBlock VerticalAlignment="Center" Text="역링크" />
                        </StackPanel>
                    </Button>
                </dev:ElementGroup>
            </Grid>
        </Grid>
    </Grid>
</Page>
